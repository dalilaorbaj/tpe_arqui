#include <stdint.h>
#include <songs.h>

//Fuente: https://github.com/ShaneMcC/beeps/blob/master/mortal-kombat.sh

Note mortal_kombat_notes[] = {
    {220, 250},
    {220, 250},
    {261, 250},
    {220, 250},
    {293, 250},
    {220, 250},
    {329, 250},
    {293, 250},
    {261, 250},
    {261, 250},
    {329, 250},
    {261, 250},
    {392, 250},
    {261, 250},
    {329, 250},
    {261, 250},
    {196, 250},
    {196, 250},
    {246, 250},
    {196, 250},
    {261, 250},
    {196, 250},
    {293, 250},
    {261, 250},
    {174, 250},
    {174, 250},
    {220, 250},
    {174, 250},
    {261, 250},
    {174, 250},
    {261, 250},
    {246, 250},
    {220, 250},
    {220, 250},
    {261, 250},
    {220, 250},
    {293, 250},
    {220, 250},
    {329, 250},
    {293, 250},
    {261, 250},
    {261, 250},
    {329, 250},
    {261, 250},
    {392, 250},
    {261, 250},
    {329, 250},
    {261, 250},
    {196, 250},
    {196, 250},
    {246, 250},
    {196, 250},
    {261, 250},
    {196, 250},
    {293, 250},
    {261, 250},
    {174, 250},
    {174, 250},
    {220, 250},
    {174, 250},
    {261, 250},
    {174, 250},
    {261, 250},
    {246, 250},
    {220, 250},
    {220, 375},
    {220, 375},
    {220, 375},
    {220, 375},
    {196, 250},
    {261, 250},
    {220, 375},
    {220, 375},
    {220, 375},
    {220, 375},
    {196, 250},
    {164, 250},
    {220, 375},
    {220, 375},
    {220, 375},
    {220, 375},
    {196, 250},
    {261, 250},
    {220, 375},
    {220, 375},
    {220, 375},
    {220, 375},
    {220, 375},
    {220, 375},
    {220, 375},
    {220, 375},
    {220, 375},
    {220, 375},
    {196, 250},
    {261, 250},
    {220, 375},
    {220, 375},
    {220, 375},
    {220, 375},
    {196, 250},
    {164, 250},
    {220, 375},
    {220, 375},
    {220, 375},
    {220, 375},
    {196, 250},
    {261, 250},
    {220, 375},
    {220, 375},
    {220, 375},
    {220, 375},
    {220, 375},
    {220, 375},
    {220, 125},
    {329, 250},
    {220, 125},
    {261, 250},
    {220, 125},
    {246, 250},
    {220, 125},
    {261, 250},
    {220, 125},
    {246, 125},
    {196, 250},
    {220, 125},
    {329, 250},
    {220, 125},
    {261, 250},
    {220, 125},
    {246, 250},
    {220, 125},
    {261, 250},
    {220, 125},
    {246, 125},
    {196, 250},
    {220, 125},
    {329, 250},
    {220, 125},
    {261, 250},
    {220, 125},
    {246, 250},
    {220, 125},
    {261, 250},
    {220, 125},
    {246, 125},
    {196, 250},
    {220, 125},
    {329, 250},
    {220, 125},
    {261, 250},
    {220, 125},
    {246, 250},
    {220, 125},
    {261, 250},
    {220, 125},
    {246, 125},
    {196, 250},
    {220, 125},
    {329, 250},
    {220, 125},
    {261, 250},
    {196, 125},
    {196, 250},
    {196, 125},
    {220, 250},
    {220, 125},
    {329, 250},
    {220, 125},
    {261, 250},
    {220, 125},
    {246, 250},
    {220, 125},
    {261, 250},
    {220, 125},
    {246, 125},
    {196, 250},
    {220, 125},
    {329, 250},
    {220, 125},
    {261, 250},
    {220, 125},
    {246, 250},
    {220, 125},
    {261, 250},
    {220, 125},
    {246, 125},
    {196, 250},
    {220, 125},
    {329, 250},
    {220, 125},
    {261, 250},
    {220, 125},
    {246, 250},
    {220, 125},
    {261, 250},
    {220, 125},
    {246, 125},
    {196, 250},
    {220, 125},
    {329, 250},
    {220, 125},
    {261, 250},
    {196, 125},
    {196, 250},
    {196, 125},
    {220, 25}
};

Note victory_sound_notes[] = {
    //(!)este es mas cortito, despues elegir cual queremos
    // {523, 150},  // C5
    // {587, 150},  // D5
    // {659, 150},  // E5
    // {698, 150},  // F5
    // {784, 300}   // G5
    {523, 200},  // C5
    {587, 200},  // D5
    {659, 200},  // E5
    {698, 200},  // F5
    {784, 300},  // G5
    {880, 300},  // A5
    {988, 300},  // B5
    {1047, 400}, // C6
    {988, 200},  // B5
    {880, 200},  // A5
    {784, 200},  // G5
    {698, 200},  // F5
    {659, 200},  // E5
    {587, 200},  // D5
    {523, 400}   // C5
};

Note got_theme_notes[] = {
    {392, 500},  // G4
    {262, 500},  // C4
    {311, 250},  // DS4
    {349, 250},  // F4
    {392, 500},  // G4
    {262, 500},  // C4
    {311, 250},  // DS4
    {349, 250},  // F4
    {392, 500},  // G4
    {262, 500},  // C4
    {311, 250},  // DS4
    {349, 250},  // F4
    {392, 500},  // G4
    {262, 500},  // C4
    {311, 250},  // DS4
    {349, 250},  // F4
    {392, 500},  // G4
    {262, 500},  // C4
    {330, 250},  // E4
    {349, 250},  // F4
    {392, 500},  // G4
    {262, 500},  // C4
    {330, 250},  // E4
    {349, 250},  // F4
    {392, 500},  // G4
    {262, 500},  // C4
    {330, 250},  // E4
    {349, 250},  // F4
    {392, 500},  // G4
    {262, 500},  // C4
    {330, 250},  // E4
    {349, 250},  // F4
    {392, 500},  // G4
    {262, 500},  // C4
    {311, 250},  // DS4
    {349, 250},  // F4
    {294, 500},  // D4
    {196, 500},  // G3
    {233, 250},  // AS3
    {262, 250},  // C4
    {294, 500},  // D4
    {196, 500},  // G3
    {233, 250},  // AS3
    {262, 250},  // C4
    {294, 500},  // D4
    {196, 500},  // G3
    {233, 250},  // AS3
    {262, 250},  // C4
    {294, 500},  // D4
    {196, 500},  // G3
    {233, 250},  // AS3
    {262, 250},  // C4
    {294, 1000}, // D4
    {349, 1000}, // F4
    {233, 1000}, // AS3
    {311, 250},  // DS4
    {294, 250},  // D4
    {349, 1000}, // F4
    {233, 1000}, // AS3
    {311, 250},  // DS4
    {294, 250},  // D4
    {262, 500},  // C4
    {208, 250},  // GS3
    {233, 250},  // AS3
    {262, 500},  // C4
    {175, 500},  // F3
    {208, 250},  // GS3
    {233, 250},  // AS3
    {262, 500},  // C4
    {175, 500},  // F3
    {208, 250},  // GS3
    {233, 250},  // AS3
    {262, 500},  // C4
    {175, 500},  // F3
    {392, 1000}, // G4
    {262, 1000}, // C4
    {311, 250},  // DS4
    {349, 250},  // F4
    {392, 1000}, // G4
    {262, 1000}, // C4
    {311, 250},  // DS4
    {349, 250},  // F4
    {294, 500},  // D4
    {196, 500},  // G3
    {233, 250},  // AS3
    {262, 250},  // C4
    {294, 500},  // D4
    {196, 500},  // G3
    {233, 250},  // AS3
    {262, 250},  // C4
    {294, 500},  // D4
    {196, 500},  // G3
    {233, 250},  // AS3
    {262, 250},  // C4
    {294, 500},  // D4
    {196, 500},  // G3
    {233, 250},  // AS3
    {262, 250},  // C4
    {294, 500}   // D4
};


Note cockroach_notes[] = {
    {131, 250}, {131, 250}, {131, 250},
    {174, 250}, {220, 250},
    {131, 250}, {131, 250}, {131, 250},
    {174, 500}, {220, 1250},
    {174, 250}, {174, 250}, {165, 250}, {165, 250},
    {147, 250}, {147, 250}, {131, 1000},
    {131, 250}, {131, 250}, {131, 250},
    {165, 500}, {196, 250},
    {131, 250}, {131, 250}, {131, 250},
    {165, 500}, {196, 1250},
    {262, 250}, {294, 250}, {262, 250}, {233, 250},
    {220, 250}, {196, 250}, {174, 500},
    {131, 250}, {131, 250}, {174, 250}, {174, 250},
    {220, 250}, {220, 250}, {262, 500},
    {220, 1250},
    {262, 500}, {294, 250}, {262, 250}, {233, 250},
    {220, 250}, {262, 250}, {233, 500},
    {196, 1250},
    {131, 250}, {131, 250}, {165, 250}, {165, 250},
    {196, 250}, {196, 250}, {233, 500},
    {196, 1250},
    {262, 500}, {294, 250}, {262, 250}, {233, 250},
    {220, 250}, {196, 250}, {174, 1000}
};

// Definici칩n de la canci칩n usando el array anterior.
Song mortal_kombat_theme = {
    .note_count = sizeof(mortal_kombat_notes) / sizeof(mortal_kombat_notes[0]),
    .notes = mortal_kombat_notes,
    .name = "Mortal Kombat Theme"
};

Song victory_sound = {
    .note_count = sizeof(victory_sound_notes) / sizeof(victory_sound_notes[0]),
    .notes = victory_sound_notes,
    .name = "Victory Sound"
};

Song cockroach_song = {
    .note_count = sizeof(cockroach_notes) / sizeof(cockroach_notes[0]),
    .notes = cockroach_notes,
    .name = "Cockroach Song"
};

Song got_theme = {
    .note_count = sizeof(got_theme_notes) / sizeof(got_theme_notes[0]),
    .notes = got_theme_notes,
    .name = "Got Theme"
};

void play_mortal_kombat_theme() {
    puts(" (press ESC to stop the song)");
    puts(" (press P to pause/unpause the song)");
    play_song(&mortal_kombat_theme);
}

void play_victory_sound() {
    play_song(&victory_sound);
}

void play_cockroach_song() {
    puts(" (press ESC to stop the song)");
    puts(" (press P to pause/unpause the song)");
    play_song(&cockroach_song);
}

void play_got_theme() {
    puts(" (press ESC to stop the song)");
    puts(" (press P to pause/unpause the song)");
    play_song(&got_theme);
}


void play_song(const Song *song) {
    int paused = 0;
    int prev_key_state = 0; 
    for (int i = 0; i < song->note_count && !isKeyPressed(SCANCODE_ESCAPE); i++) {
        
        int current_key_state = isKeyPressed(SCANCODE_P);
        if (current_key_state && !prev_key_state) {
            paused = !paused;
        }
        prev_key_state = current_key_state;
        
        // Si est치 pausado, no reproducir la nota y repetir el bucle
        if (paused) {
            i--;  // Repetir la misma nota cuando se despause
            continue;
        }
        
        Note note = song->notes[i];
        int ticks = note.duration / MS_PER_TICK;
        beep(note.frequency, ticks);
    }
    flushKeyboardBuffer(); // Limpiar el buffer del teclado al finalizar la canci칩n
}